{"ast":null,"code":"const TokenProvider = () => {\n  const getExpirationDate = jwtToken => {\n    if (jwtToken == null) {\n      return null;\n    }\n    const jwt = JSON.parse(atob(jwtToken.split('.')[1]));\n    return jwt && jwt.exp && jwt.exp * 1000 || null;\n  };\n  const isExpired = exp => {\n    if (!exp) {\n      return false;\n    }\n    return Date.now() > exp;\n  };\n  const getToken = async () => {\n    if (sessionStorage.accessToken == null) {\n      return null;\n    }\n    if (isExpired(getExpirationDate(sessionStorage.accessToken))) {\n      const updatedToken = await fetch('https://localhost:7002/Auth/refreshToken', {\n        method: 'PUT',\n        body: sessionStorage.refreshToken\n      });\n      if (updatedToken.status != 200) setToken(null, null);\n      return null;\n      const j = await updatedToken.json();\n      setToken(j.accessToken, j.refreshToken);\n    }\n    return sessionStorage.accessToken;\n  };\n  const setToken = (accessToken, refreshToken) => {\n    if (accessToken != null) {\n      sessionStorage.setItem(\"accessToken\", accessToken);\n      sessionStorage.setItem(\"refreshToken\", refreshToken);\n    } else {\n      localStorage.removeItem(\"accessToken\");\n      localStorage.removeItem(\"refreshToken\");\n    }\n  };\n  const Login = async (email, pass) => {\n    const response = await fetch(\"https://localhost:7002/Auth/login\", {\n      method: \"POST\",\n      headers: {\n        'Accept': 'application/json',\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({\n        login: email,\n        password: pass\n      })\n    });\n    if (response.ok) {\n      let json = await response.json();\n      sessionStorage.setItem(\"accessToken\", json.accessToken);\n      sessionStorage.setItem(\"refreshToken\", json.refreshToken);\n    }\n    return response.status;\n  };\n  return {\n    getToken,\n    setToken,\n    Login\n  };\n};\n_c = TokenProvider;\nexport const {\n  getToken,\n  setToken,\n  Login\n} = createAuthProvider();\nexport default TokenProvider;\nvar _c;\n$RefreshReg$(_c, \"TokenProvider\");","map":{"version":3,"names":["TokenProvider","getExpirationDate","jwtToken","jwt","JSON","parse","atob","split","exp","isExpired","Date","now","getToken","sessionStorage","accessToken","updatedToken","fetch","method","body","refreshToken","status","setToken","j","json","setItem","localStorage","removeItem","Login","email","pass","response","headers","stringify","login","password","ok","_c","createAuthProvider","$RefreshReg$"],"sources":["C:/Users/Дима/OneDrive/Документы/react/reactApp/src/shared/TokenProvider.ts"],"sourcesContent":["const TokenProvider = () => {\r\n\r\n    const getExpirationDate = (jwtToken?) => {\r\n        if (jwtToken==null) {\r\n            return null;\r\n        }\r\n        const jwt = JSON.parse(atob(jwtToken.split('.')[1]));\r\n        return jwt && jwt.exp && jwt.exp * 1000 || null;\r\n    };\r\n\r\n\r\n    const isExpired = (exp?) => {\r\n        if (!exp) {\r\n            return false;\r\n        }\r\n        return Date.now() > exp;\r\n    };\r\n\r\n\r\n    const getToken = async () => {\r\n        if (sessionStorage.accessToken==null) {\r\n            return null;\r\n        }  \r\n        if (isExpired(getExpirationDate(sessionStorage.accessToken))) {\r\n            const updatedToken = await fetch('https://localhost:7002/Auth/refreshToken', {\r\n                method: 'PUT',\r\n                body: sessionStorage.refreshToken\r\n            })\r\n            if (updatedToken.status!=200)\r\n                setToken(null, null);\r\n                return null\r\n            const j = await updatedToken.json()\r\n            setToken(j.accessToken, j.refreshToken);\r\n        }\r\n        return sessionStorage.accessToken;\r\n    };\r\n\r\n    const setToken = (accessToken, refreshToken) => {\r\n        if (accessToken !=null) {\r\n            sessionStorage.setItem(\"accessToken\", accessToken);\r\n            sessionStorage.setItem(\"refreshToken\", refreshToken);\r\n        } else {\r\n            localStorage.removeItem(\"accessToken\");\r\n            localStorage.removeItem(\"refreshToken\");\r\n        }\r\n    };\r\n\r\n    const Login = async (email: string, pass: string) => {\r\n        const response = await fetch(\"https://localhost:7002/Auth/login\",\r\n            {\r\n              method: \"POST\",\r\n              headers:     \r\n              {\r\n                'Accept': 'application/json',\r\n                'Content-Type': 'application/json'\r\n              },\r\n              body: JSON.stringify({\r\n                login: email,\r\n                password: pass\r\n              })\r\n            });\r\n              \r\n            if(response.ok)\r\n            {\r\n              let json = await response.json();\r\n              sessionStorage.setItem(\"accessToken\", json.accessToken);\r\n              sessionStorage.setItem(\"refreshToken\", json.refreshToken);\r\n            }\r\n            return response.status;\r\n    }\r\n\r\n    return {\r\n        getToken,\r\n        setToken,\r\n        Login\r\n    };\r\n};\r\n\r\nexport const {getToken, setToken, Login} = createAuthProvider();\r\nexport default TokenProvider;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}